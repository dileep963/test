name: "Fetch Workflow Jobs"
description: "Fetches the last few workflow runs and their jobs based on specified duration and status exclusions."
author: "Dileep"
inputs:
  github_token:
    description: "GitHub Token for authentication"
    required: true
  repo:
    description: "GitHub repository in the format owner/repo"
    required: true
  workflow_name:
    description: "GitHub workflow file name (e.g., manual-trigger.yml)"
    required: true
  duration:
    description: "Duration to fetch workflow data (e.g., '1w', '2w', '1m')"
    required: false
    default: "1w"  # Default to 1 week if not provided
  output_file:
    description: "The output file to store the job data"
    required: false
    default: "final.json"  # Default to "final.json" if not provided
  exclude_overall_status:
    description: "Exclude workflow runs based on the overall status (queued, success, failure, cancelled, in_progress)."
    required: false
    default: ''



runs:
  using: "composite"
  steps:
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.10"

    - name: Install dependencies
      run: pip install requests
      shell: bash

    - name: Execute Python script
      run: python ${{ github.action_path }}/history.py
      shell: bash
      env:
        GITHUB_TOKEN: ${{ inputs.github_token }}
        RUNS_API: ${{ format('https://api.github.com/repos/{}/actions/workflows/{}/runs', inputs.repo, inputs.workflow_name) }}
        JOBS_API: ${{ format('https://api.github.com/repos/{}/actions/runs', inputs.repo) }}
        DURATION: ${{ inputs.duration }}
        OUTPUT_FILE: ${{ inputs.output_file }}
        EXCLUDE_STATUS: ${{ inputs.exclude_overall_status }}
